{% extends "base.html" %}

{% block title %}Sign Up - EPU{% endblock %}

{% block content %}
<div class="container section center">
    <div class="page-hero center">
        <h1 class="hero-title">Create your account</h1>
        <p class="hero-sub">Start hosting events and collecting memories.</p>
    </div>
    <form class="card form center" method="post" action="/auth/signup" style="max-width:620px;">
            <div class="floating-field">
                <label for="first_name" class="fl-label">First Name</label>
                <input class="input-field" type="text" id="first_name" name="first_name" required value="{{ first_name or '' }}" autocomplete="given-name" autofocus>
            </div>
            <div class="floating-field">
                <label for="last_name" class="fl-label">Last Name</label>
                <input class="input-field" type="text" id="last_name" name="last_name" required value="{{ last_name or '' }}" autocomplete="family-name">
            </div>
            <div class="floating-field">
                <label for="email" class="fl-label">Email</label>
                <input class="input-field" type="email" id="email" name="email" required value="{{ email or '' }}" autocomplete="email">
            </div>
            <div class="floating-field">
                <label for="password" class="fl-label">Password</label>
                <input class="input-field" type="password" id="password" name="password" required autocomplete="new-password">
            </div>
            <div class="password-policy" id="password-policy" style="display:none;">
                <p class="policy-title">Password must contain:</p>
                <ul class="policy-list" id="policy-list">
                    <li id="length-check" class="policy-item">At least 8 characters</li>
                    <li id="number-check" class="policy-item">At least 1 number</li>
                    <li id="capital-check" class="policy-item">At least 1 capital letter</li>
                    <li id="special-check" class="policy-item">At least 1 special character</li>
                </ul>
            </div>
            {% if error %}
            <div class="notice error">{{ error }}</div>
            {% endif %}
            <input type="hidden" name="csrf_token" value="{{ csrf_token or '' }}">
            <input type="hidden" name="captcha_token" value="">
            {% set text = "Sign up" %}
            {% set class = "btn primary block" %}
            {% set type = "submit" %}
            {% include "components/button.html" %}
        </form>
    <p class="p muted" style="margin-top:12px;">We'll send a verification link to your email. You must verify before logging in.</p>
    <div class="section">
        <span class="muted">Already have an account?</span>
        <a class="btn" href="/login">Log in</a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('password');
    const passwordPolicy = document.getElementById('password-policy');
    const policyList = document.getElementById('policy-list');
    const checks = [
        { id: 'length-check', test: pwd => pwd.length >= 8 },
        { id: 'number-check', test: pwd => /\d/.test(pwd) },
        { id: 'capital-check', test: pwd => /[A-Z]/.test(pwd) },
        { id: 'special-check', test: pwd => /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(pwd) }
    ];

    function updatePolicy() {
        const pwd = passwordInput.value;
        let unmet = 0;
        checks.forEach(({id, test}) => {
            const el = document.getElementById(id);
            if (!test(pwd)) {
                el.style.display = '';
                unmet++;
            } else {
                el.style.display = 'none';
            }
        });
        // Hide the whole policy if all are met
        passwordPolicy.style.display = (pwd && unmet > 0) ? '' : 'none';
    }

    passwordInput.addEventListener('focus', function() {
        updatePolicy();
    });
    passwordInput.addEventListener('input', function() {
        updatePolicy();
    });
    passwordInput.addEventListener('blur', function() {
        setTimeout(() => { passwordPolicy.style.display = 'none'; }, 100);
    });
});
</script>
{% endblock %}