{% extends "base.html" %}
{% from "components/macros.html" import page_hero %}

{% block title %}Billing Summary - EPU{% endblock %}

{% block breadcrumbs %}
{% from 'components/macros.html' import breadcrumbs %}
<div class="breadcrumbs-container section" style="padding-bottom:0;">
  {{ breadcrumbs([{'label':'Profile','href':'/profile'}], 'Billing') }}
  </div>
{% endblock %}
{% block content %}
<div class="container section center">
  {% from 'components/macros.html' import chip, notice, btn_row %}
  {{ page_hero('Billing Summary', 'Recent purchases and payment status.', True) }}
  <div class="card" style="max-width:760px;margin:0 auto;">
    <style>
  /* Use a single grid on the table so column widths are consistent across rows. */
  /* Spread columns a bit more evenly and reduce Purchase column width */
  .table { display: grid; grid-template-columns: 1.6fr 1fr 0.8fr 0.8fr; width:100%; }
  /* Each logical row becomes "contents" so its cells participate in the parent grid
     (keeps visual grouping while ensuring columns line up). */
  .row { display: contents; }
  .row.head .cell { font-weight:600; opacity:0.85; border-bottom-color: rgba(255,255,255,0.18); }
  .cell { overflow:hidden; text-overflow:ellipsis; white-space:nowrap; padding:8px 6px; border-bottom:1px solid rgba(255,255,255,0.08); align-items:center; display:flex; }
  /* Do not shorten the purchase summary; allow wrapping */
  .cell.purchase { white-space: normal; overflow: visible; text-overflow: clip; word-break: break-word; }
  /* Left-align amounts to match the column and avoid excessive right padding */
  .cell.amount { text-align: left; justify-content:flex-start; font-variant-numeric: tabular-nums; padding-left:6px; }
    </style>
    {% if items and items|length > 0 %}
      <div class="table" role="table" aria-label="Recent purchases">
        <div class="row head" role="row">
          <div class="cell" role="columnheader">Purchase</div>
          <div class="cell" role="columnheader">Date</div>
          <div class="cell" role="columnheader">Amount</div>
          <div class="cell" role="columnheader">Status</div>
        </div>
        {% for i in items %}
        <div class="row" role="row">
          <div class="cell purchase" role="cell">
            <a href="/billing/purchase/{{ i.id }}">{{ i.plan_name or 'Plan' }}</a>
          </div>
          <div class="cell" role="cell">{{ i.created.strftime('%d %B %Y') if i.created else '' }}</div>
          <div class="cell amount" role="cell">{{ i.amount }}</div>
          <div class="cell" role="cell">
            {# Normalize status codes to human-readable and map to standard variants #}
            {% set _raw = (i.status or '')|lower %}
            {% if _raw in ['paid','success','s'] %}
              {% set _norm = 'paid' %}
            {% elif _raw in ['pending','in_progress','p'] %}
              {% set _norm = 'pending' %}
            {% elif _raw in ['refunded','r'] %}
              {% set _norm = 'refunded' %}
            {% elif _raw in ['canceled','cancelled','c'] %}
              {% set _norm = 'canceled' %}
            {% else %}
              {% set _norm = _raw %}
            {% endif %}
            {% set status_class = 'status-' + (_norm if _norm in ['paid','pending','refunded','canceled'] else 'other') %}
            {{ chip(((_norm or 'â€”')|capitalize), _norm if _norm in ['paid','pending','refunded','canceled'] else '') }}
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      {{ notice('No purchases yet.', 'info', 'style="margin:12px 0;"') }}
    {% endif %}
    {% call btn_row('style="margin-top:12px; display:flex; justify-content:center; gap:8px;"') %}
      <a class="btn" href="/pricing">Choose a package</a>
      <a class="btn" href="/profile">Back to Profile</a>
    {% endcall %}
  </div>
</div>
{% endblock %}
